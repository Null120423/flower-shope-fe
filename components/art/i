"use client";
import { useState } from "react";
import CartHeader from "./components/CartHeader";
import CartItemsList from "./components/CartItemsList";
import CartSummary from "./components/CartSummary";
import RecommendedProducts from "./components/RecommendedProducts";

export interface CartItem {
  id: number;
  name: string;
  price: number;
  originalPrice?: number;
  image: string;
  quantity: number;
  bgColor: string;
  category: string;
}

export interface RecommendedProduct {
  id: number;
  name: string;
  price: number;
  image: string;
  rating: number;
  bgColor: string;
}

export default function CartView() {
  const [cartItems, setCartItems] = useState<CartItem[]>([
    {
      id: 1,
      name: "Your Floral Wonderland",
      price: 89.99,
      originalPrice: 120.0,
      image: "/1.png",
      quantity: 1,
      bgColor: "bg-pink-100",
      category: "Premium Bouquet",
    },
    {
      id: 2,
      name: "Spring Garden Mix",
      price: 65.99,
      image: "/2.png",
      quantity: 2,
      bgColor: "bg-green-100",
      category: "Seasonal",
    },
    {
      id: 3,
      name: "Rose Elegance",
      price: 78.99,
      image: "/3.png",
      quantity: 1,
      bgColor: "bg-rose-100",
      category: "Classic",
    },
  ]);

  const recommendedProducts: RecommendedProduct[] = [
    {
      id: 4,
      name: "Wedding Bouquet",
      price: 125.99,
      image: "/4.png",
      rating: 4.9,
      bgColor: "bg-purple-100",
    },
    {
      id: 5,
      name: "Cute Corsage",
      price: 29.99,
      image: "/5.png",
      rating: 4.7,
      bgColor: "bg-yellow-100",
    },
    {
      id: 6,
      name: "Corporate Arrangement",
      price: 95.99,
      image: "/1.png",
      rating: 4.8,
      bgColor: "bg-blue-100",
    },
    {
      id: 7,
      name: "Home Decor Flowers",
      price: 55.99,
      image: "/2.png",
      rating: 4.6,
      bgColor: "bg-orange-100",
    },
  ];

  const updateQuantity = (id: number, newQuantity: number) => {
    if (newQuantity <= 0) {
      removeItem(id);
      return;
    }
    setCartItems((items) =>
      items.map((item) =>
        item.id === id ? { ...item, quantity: newQuantity } : item
      )
    );
  };

  const removeItem = (id: number) => {
    setCartItems((items) => items.filter((item) => item.id !== id));
  };

  const addToCart = (product: RecommendedProduct) => {
    const existingItem = cartItems.find((item) => item.id === product.id);

    if (existingItem) {
      updateQuantity(product.id, existingItem.quantity + 1);
    } else {
      const newItem: CartItem = {
        id: product.id,
        name: product.name,
        price: product.price,
        image: product.image,
        quantity: 1,
        bgColor: product.bgColor,
        category: "Recommended",
      };
      setCartItems((items) => [...items, newItem]);
    }
  };

  const subtotal = cartItems.reduce(
    (sum, item) => sum + item.price * item.quantity,
    0
  );
  const discount = cartItems.reduce((sum, item) => {
    if (item.originalPrice) {
      return sum + (item.originalPrice - item.price) * item.quantity;
    }
    return sum;
  }, 0);
  const shipping = subtotal > 100 ? 0 : 9.99;
  const tax = subtotal * 0.08;
  const total = subtotal + shipping + tax;

  return (
    <div className="min-h-screen bg-gradient-to-br from-bg-primary via-bg-secondary to-bg-primary">
      <div className="container mx-auto px-6 py-8">
        {/* Header */}
        <CartHeader itemCount={cartItems.length} />

        {/* Main Content */}
        <div className="grid lg:grid-cols-3 gap-8 mt-8">
          {/* Left Section - Cart Items */}
          <div className="lg:col-span-2 space-y-6">
            <CartItemsList
              items={cartItems}
              onUpdateQuantity={updateQuantity}
              onRemoveItem={removeItem}
            />

            <RecommendedProducts
              products={recommendedProducts}
              onAddToCart={addToCart}
            />
          </div>

          {/* Right Section - Cart Summary & Checkout */}
          <div className="space-y-6">
            <CartSummary
              subtotal={subtotal}
              discount={discount}
              shipping={shipping}
              tax={tax}
              total={total}
              itemCount={0}
            />
          </div>
        </div>
      </div>
    </div>
  );
}
